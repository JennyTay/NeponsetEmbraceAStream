---
title: "TemperatureMaps"
author: "Jennifer Rogers"
date: "9/14/2021"
output: html_document
---

```{r}

library(ggspatial)


#load bio data for spaitl info
bio <- st_read("MassWildlife_EAS_combined_results.shp")
bio$year <- year(bio$date)

#load temperature metrics
load("StrmTempMetrics_2020_2021.RData") 
metrics <- metrics %>% 
  group_by(site, season) %>% 
  summarise(max7avg = mean(max7avg),
            grt20 = mean(grt20))

#Left join
tmppts <- left_join(bio, metrics, by = c("site", "season")) %>% 
  filter(!is.na(site),
         !is.na(max7avg)) 
 

#load watershed
wtrshd_bndry <- st_read("raw_data/watershed/IL_DWMWPP_WATERSHEDS_POLY.shp") %>% 
  filter(DWM_NAME == "BOSTON HARBOR: Neponset")

#load streams
strms <- st_read("raw_data/watershed/IL_2016_ARC_NeponsetClip.shp")

#load ponds
pnds <- st_read("raw_data/watershed/IL_2016_POLY_NeponsetClip.shp")


myPalette <- colorRampPalette(rev(brewer.pal(9, "RdYlBu")))

ggplot() +
  geom_sf(data = wtrshd_bndry, fill = grey(0.4), alpha = 0.4, color = gray(.7), lwd = 1) +
  geom_sf(data = strms, color = "deepskyblue2") +
  geom_sf(data = pnds, fill = "deepskyblue2", color = "deepskyblue2") +
  geom_sf(data = tmppts, aes(fill = max7avg), colour = "black", pch = 21, size = 4)+
  scale_fill_gradientn(colours = myPalette(100), limits = c(min(tmppts$max7avg), max(tmppts$max7avg)))+
   theme_bw() +
  theme(panel.grid = element_line(colour = "transparent"),
    axis.title = element_blank(),
    axis.text = element_blank(),
    legend.text = element_text(size = 14),
    legend.title = element_text(size = 14),
    strip.text.x = element_text(size = 14))+
  facet_wrap(~season)+
  labs(fill = "T (Â°C)")+
  annotation_scale(location = "br", width_hint = 0.3, height = unit(.25, "cm"), text_cex = 1) +
  annotation_north_arrow(location = "br", which_north = "true", 
                        pad_x = unit(0.5, "in"), pad_y = unit(0.5, "in"),
                        style = north_arrow_fancy_orienteering(text_size = 10),
                        height = unit(1.5, "cm"), width = unit(1.5, "cm"))
ggsave(plot = last_plot(), filename = "final_figs_tables/max7avg_map.png", width = 10, height = 6, units = "in", dpi = 300)




```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
